---
import Layout from '../layouts/Layout.astro';
import SectionTitle from '../components/shared/SectionTitle.astro';
import BlogGrid from '../components/blog/BlogGrid.astro';
import CategoryFilter from '../components/blog/CategoryFilter.astro';
import { sanityClient, POSTS_QUERY, CATEGORIES_QUERY } from '../lib/sanity';
import { BookOpen } from 'lucide-react';
import { examplePosts } from '../data/examplePosts.js';

// Obtener posts y categorías de Sanity
let posts = [];
let categories = [];

try {
  posts = await sanityClient.fetch(POSTS_QUERY);
  categories = await sanityClient.fetch(CATEGORIES_QUERY);
} catch (error) {
  console.error('Error fetching blog data:', error);
  // Si Sanity no está configurado aún, usar datos de ejemplo
  posts = examplePosts.map(post => ({
    ...post,
    featured: post._id === '1' // Marcar el primero como destacado
  }));
  
  categories = [
    { _id: '1', title: 'Inteligencia Artificial', slug: { current: 'ia' }, color: 'azul-electrico' },
    { _id: '2', title: 'Digitalización', slug: { current: 'digitalizacion' }, color: 'celeste-tech' },
    { _id: '3', title: 'Marketing', slug: { current: 'marketing' }, color: 'gris-azulado' },
    { _id: '4', title: 'Gestión', slug: { current: 'gestion' }, color: 'azul-profundo' }
  ];
}
---

<Layout 
  title="Blog - Vete a la Cima" 
  description="Recursos y artículos sobre gestión, digitalización, IA y marketing para clínicas veterinarias."
>
  <!-- Hero del Blog - Rediseñado -->
  <section class="min-h-[75vh] md:min-h-[85vh] pt-24 md:pt-28 lg:pt-32 flex items-end md:items-center relative overflow-hidden bg-[#0a1929]">
    <!-- Background con imagen -->
    <div class="absolute inset-0 z-0">
      <div class="absolute inset-0 bg-[#0a1929]"></div>
      
      <!-- Imagen Mobile: vir11.webp -->
      <img 
        src="/images/about/vir11.webp" 
        alt="Blog Vete a la Cima" 
        class="md:hidden w-full h-full object-cover opacity-60"
        style="object-position: center 35%;"
      />
      
      <!-- Imagen Desktop: 8.webp -->
      <img 
        src="/images/hero/carruselhero/8.webp" 
        alt="Blog Vete a la Cima" 
        class="hidden md:block w-full h-full object-cover opacity-60"
        style="object-position: center -50%;"
      />
      
      <!-- Overlays graduales muy suaves -->
      <div class="absolute inset-0 bg-gradient-to-b from-[#0a1929]/20 via-transparent to-[#0a1929]/30"></div>
    </div>

    <!-- Grid pattern sutil -->
    <div class="absolute inset-0 opacity-[0.02] z-[1]" style="background-image: radial-gradient(circle at 2px 2px, white 1px, transparent 0); background-size: 48px 48px;"></div>

    <!-- Floating gradient orbs -->
    <div class="absolute top-20 -left-20 w-96 h-96 bg-[#b4cfa6]/10 rounded-full blur-3xl opacity-60 animate-float"></div>
    <div class="absolute bottom-20 -right-20 w-96 h-96 bg-[#66D4FF]/10 rounded-full blur-3xl opacity-60 animate-float-delayed"></div>

    <div class="container-custom px-4 md:px-8 relative z-10 pb-12 pt-0 md:py-32">
      <div class="max-w-4xl mx-auto text-center text-white">

        <!-- Título principal -->
        <h1 class="font-heading font-bold text-4xl md:text-5xl lg:text-6xl xl:text-7xl mb-6 md:mb-8 leading-tight">
          <span class="block text-white mb-2">Blog</span>
          <span class="block text-transparent bg-clip-text bg-gradient-to-r from-[#b4cfa6] via-[#a5c096] to-[#66D4FF]">
            Vete a la Cima
          </span>
        </h1>

        <!-- Línea decorativa -->
        <div class="flex items-center justify-center gap-3 mb-6 md:mb-8">
          <div class="h-[2px] w-16 bg-gradient-to-r from-transparent to-[#b4cfa6]"></div>
          <div class="w-2 h-2 rounded-full bg-[#b4cfa6]"></div>
          <div class="h-[2px] w-16 bg-gradient-to-l from-transparent to-[#b4cfa6]"></div>
        </div>

        <!-- Descripción -->
        <p class="text-lg md:text-xl lg:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed font-light">
          Artículos sobre gestión, digitalización, inteligencia artificial y marketing para clínicas veterinarias que quieren crecer.
        </p>

      </div>
    </div>
  </section>

  <!-- Filtro de Categorías - Mejorado -->
  <section class="py-8 md:py-12 bg-[#0a1929] border-b border-white/10">
    <div class="container-custom px-4 md:px-8">
      <CategoryFilter categories={categories} />
    </div>
  </section>

  <!-- Grid de Artículos - Mejorado -->
  <section class="py-12 md:py-20 bg-gradient-to-b from-[#0a1929] to-[#0f1f33] relative overflow-hidden">
    <!-- Decorative blur accents -->
    <div class="absolute top-40 right-20 w-96 h-96 bg-[#66D4FF]/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 left-20 w-96 h-96 bg-[#b4cfa6]/5 rounded-full blur-3xl"></div>
    
    <div class="container-custom px-4 md:px-8 relative z-10">
      {posts.length > 0 ? (
        <BlogGrid posts={posts} />
      ) : (
        <div class="text-center py-20">
          <div class="max-w-md mx-auto">
            <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-white/5 backdrop-blur-sm border border-white/10 flex items-center justify-center">
              <BookOpen className="w-10 h-10 text-[#b4cfa6]" />
            </div>
            <h3 class="text-2xl md:text-3xl font-bold text-white mb-3 font-heading">
              No hay artículos aún
            </h3>
            <p class="text-lg text-white/70">
              Pronto comenzaremos a publicar contenido valioso para ti.
            </p>
          </div>
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  /* Animaciones */
  @keyframes float {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-20px);
    }
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  .animate-float-delayed {
    animation: float 6s ease-in-out infinite 3s;
  }
</style>
