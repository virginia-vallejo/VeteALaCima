---
import Layout from '../layouts/Layout.astro';
import SectionTitle from '../components/shared/SectionTitle.astro';
import BlogGrid from '../components/blog/BlogGrid.astro';
import CategoryFilter from '../components/blog/CategoryFilter.astro';
import { sanityClient, POSTS_QUERY, CATEGORIES_QUERY } from '../lib/sanity';
import { BookOpen } from 'lucide-react';
import { examplePosts } from '../data/examplePosts.js';

// Obtener posts y categorías de Sanity
let posts = [];
let categories = [];

try {
  posts = await sanityClient.fetch(POSTS_QUERY);
  categories = await sanityClient.fetch(CATEGORIES_QUERY);
} catch (error) {
  console.error('Error fetching blog data:', error);
  // Si Sanity no está configurado aún, usar datos de ejemplo
  posts = examplePosts.map(post => ({
    ...post,
    featured: post._id === '1' // Marcar el primero como destacado
  }));
  
  categories = [
    { _id: '1', title: 'Inteligencia Artificial', slug: { current: 'ia' }, color: 'azul-electrico' },
    { _id: '2', title: 'Digitalización', slug: { current: 'digitalizacion' }, color: 'celeste-tech' },
    { _id: '3', title: 'Marketing', slug: { current: 'marketing' }, color: 'gris-azulado' },
    { _id: '4', title: 'Gestión', slug: { current: 'gestion' }, color: 'azul-profundo' }
  ];
}
---

<Layout 
  title="Blog - Vete a la Cima" 
  description="Recursos y artículos sobre gestión, digitalización, IA y marketing para clínicas veterinarias."
>
  <!-- Hero del Blog -->
  <section class="pt-[22rem] md:pt-[24rem] lg:pt-[28rem] bg-gradient-to-br from-[#294a5f] via-[#3e6680] to-[#b4cfa6] py-20 lg:py-28 relative overflow-hidden">
    <div class="absolute inset-0 z-0">
      <img src="/images/about/vir2.webp" alt="Hero Blog" class="w-full h-full object-cover object-center opacity-70" />
      <div class="absolute inset-0 bg-gradient-to-br from-[#294a5f]/80 via-[#3e6680]/80 to-[#b4cfa6]/80"></div>
    </div>
    <div class="container mx-auto px-6 lg:px-8 relative z-10">
      <div class="max-w-4xl mx-auto text-center text-white">
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full mb-6">
          <BookOpen className="w-5 h-5" />
          <span class="text-sm font-medium">Recursos y conocimiento</span>
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold font-['Poppins'] mb-6">
          Blog Vete a la Cima
        </h1>
        <p class="text-xl md:text-2xl text-white/90 max-w-2xl mx-auto">
          Artículos sobre gestión, digitalización, inteligencia artificial y marketing para clínicas veterinarias que quieren crecer.
        </p>
      </div>
    </div>
  </section>

  <!-- Filtro de Categorías -->
  <section class="py-12 bg-[#F5F7FA]">
    <div class="container mx-auto px-6 lg:px-8">
      <CategoryFilter categories={categories} />
    </div>
  </section>

  <!-- Grid de Artículos -->
  <section class="py-16 bg-[#F5F7FA]">
    <div class="container mx-auto px-6 lg:px-8">
      {posts.length > 0 ? (
        <BlogGrid posts={posts} />
      ) : (
        <div class="text-center py-20">
          <BookOpen className="w-16 h-16 text-[#A3B7C9] mx-auto mb-4" />
          <h3 class="text-2xl font-bold text-[#0A1B2E] mb-2">
            No hay artículos aún
          </h3>
          <p class="text-[#A3B7C9]">
            Pronto comenzaremos a publicar contenido valioso para ti.
          </p>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Newsletter (Opcional) -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-6 lg:px-8">
      <div class="max-w-4xl mx-auto bg-gradient-to-r from-[#3e6680] to-[#b4cfa6] rounded-3xl p-8 md:p-12 text-center text-white">
        <h2 class="text-3xl md:text-4xl font-bold font-['Poppins'] mb-4">
          Recibe los mejores consejos en tu inbox
        </h2>
        <p class="text-lg mb-8 text-white/90">
          Suscríbete para recibir artículos exclusivos sobre cómo hacer crecer tu clínica veterinaria.
        </p>
        <form class="flex flex-col sm:flex-row gap-4 max-w-xl mx-auto">
          <input 
            type="email" 
            placeholder="Tu correo electrónico"
            class="flex-1 px-6 py-4 rounded-full text-[#0A1B2E] focus:outline-none focus:ring-2 focus:ring-white"
            required
          />
          <button 
            type="submit"
            class="bg-[#0A1B2E] text-white px-8 py-4 rounded-full font-['Montserrat'] font-semibold hover:bg-[#0A1B2E]/90 transition-colors"
          >
            Suscribirme
          </button>
        </form>
      </div>
    </div>
  </section>
</Layout>
