---
import Badge from '../shared/Badge.astro';
import Button from '../shared/Button.astro';
import { Check } from 'lucide-react';
import { siteConfig } from '../../data/siteConfig';
import { formatWhatsAppLink } from '../../utils/helpers';

interface Props {
  plan: {
    id: string;
    name: string;
    price: number | null;
    priceLabel?: string;
    currency: string;
    billing: string;
    description: string;
    features: string[];
    cta: string;
    ctaLink: string;
    highlighted: boolean;
    badge: string | null;
  };
}

const { plan } = Astro.props;

// Crear mensaje de WhatsApp específico para cada plan
const whatsappMessage = `Hola! Me interesa contratar el Plan ${plan.name}. ¿Podrían brindarme más información?`;
const whatsappLink = formatWhatsAppLink(siteConfig.whatsapp, whatsappMessage);
---

<div 
  class:list={[
    "pricing-card bg-white/10 backdrop-blur-xl border rounded-3xl relative transition-all duration-500 group",
    plan.highlighted ? "pricing-card-highlighted border-celeste-tech/40" : "pricing-card-standard border-white/20"
  ]}
>
  <!-- Subtle glow effect on hover -->
  <div class:list={[
    "absolute inset-0 rounded-3xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 -z-10",
    plan.highlighted ? "bg-celeste-tech/20" : "bg-white/10"
  ]}></div>
  
  <!-- Top accent line -->
  <div class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-white/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
  
  <!-- Card content wrapper -->
  <div class="relative p-8 md:p-10">
    <!-- Floating badge -->
    {plan.badge && (
      <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 pricing-badge">
        <div class="relative">
          <div class="absolute inset-0 bg-celeste-tech/20 rounded-full blur-md"></div>
          <div class="relative bg-celeste-tech backdrop-blur-md text-azul-profundo px-6 py-2 rounded-full font-bold text-sm border border-celeste-tech/30">
            <span class="relative z-10">{plan.badge}</span>
          </div>
        </div>
      </div>
    )}

    <!-- Plan Header -->
    <div class="text-center mb-10 mt-2">
      <h3 class:list={[
        "font-heading font-bold text-2xl sm:text-3xl md:text-4xl mb-3 transition-all duration-300 group-hover:scale-105",
        plan.highlighted ? "text-celeste-tech" : "text-white group-hover:text-celeste-tech"
      ]}>
        {plan.name}
      </h3>
      <p class="text-white/70 text-base md:text-lg mb-8">
        {plan.description}
      </p>
      
      <!-- Price with enterprise styling -->
      <div class="pricing-price-wrapper mb-4">
        {plan.price !== null ? (
          <div class="relative inline-block">
            <!-- Subtle glow effect behind price -->
            <div class:list={[
              "absolute inset-0 blur-xl opacity-0 group-hover:opacity-60 transition-opacity duration-500",
              plan.highlighted ? "bg-celeste-tech/30" : "bg-white/20"
            ]}></div>
            
            <div class="relative">
              <div class="flex items-start justify-center">
                <span class="text-2xl font-bold text-white/60 mt-2">$</span>
                <span class:list={[
                  "text-5xl sm:text-6xl md:text-7xl font-heading font-bold mx-1 pricing-price-number",
                  plan.highlighted ? "text-celeste-tech" : "text-white group-hover:text-celeste-tech"
                ]}>
                  {plan.price}
                </span>
              </div>
              <div class="text-sm text-white/60 mt-2 font-medium">
                {plan.currency}/{plan.billing}
              </div>
            </div>
          </div>
        ) : (
          <div class="text-5xl md:text-6xl font-heading font-bold text-celeste-tech pricing-custom-label">
            {plan.priceLabel || 'A medida'}
          </div>
        )}
      </div>
    </div>

    <!-- Features List with staggered animation -->
    <ul class="space-y-4 mb-10">
      {plan.features.map((feature, index) => (
        <li 
          class="flex items-start space-x-3 pricing-feature-item"
          style={`animation-delay: ${index * 0.1}s`}
        >
          <div class:list={[
            "flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mt-0.5 transition-all duration-300 group-hover:scale-110",
            plan.highlighted ? "bg-celeste-tech/30 border border-celeste-tech/40" : "bg-white/20 border border-white/30"
          ]}>
            <Check 
              class={plan.highlighted ? "text-celeste-tech" : "text-white"} 
              size={16} 
            />
          </div>
          <span class="text-white/90 text-base md:text-lg leading-relaxed">
            {feature}
          </span>
        </li>
      ))}
    </ul>

    <!-- CTA Button with premium effects -->
    <div class="pricing-cta-container">
      <a
        href={whatsappLink}
        target="_blank"
        rel="noopener noreferrer"
        class:list={[
          "w-full inline-flex items-center justify-center gap-2 px-8 py-4 rounded-xl font-button font-bold text-lg transition-all duration-300 hover:scale-105 pricing-cta-button",
          plan.highlighted 
            ? "bg-gradient-to-r from-[#66D4FF] to-[#4A738A] text-white hover:shadow-[0_0_30px_rgba(102,212,255,0.5)] shadow-lg shadow-azul-electrico/40" 
            : "bg-white/10 backdrop-blur-sm text-white border-2 border-white/40 hover:bg-white/20 hover:border-[#b4cfa6]/50"
        ]}
      >
        {plan.cta}
      </a>
    </div>
    
    <!-- Corner accents -->
    <div class:list={[
      "absolute top-4 right-4 w-16 h-16 opacity-0 group-hover:opacity-100 transition-opacity duration-500",
      "border-t border-r rounded-tr-3xl",
      plan.highlighted ? "border-celeste-tech/50" : "border-white/30"
    ]}></div>
    <div class:list={[
      "absolute bottom-4 left-4 w-16 h-16 opacity-0 group-hover:opacity-100 transition-opacity duration-500",
      "border-b border-l rounded-bl-3xl",
      plan.highlighted ? "border-celeste-tech/50" : "border-white/30"
    ]}></div>
  </div>
</div>

<style>
  /* Card base styles - Enterprise glassmorphism */
  .pricing-card {
    transform-style: preserve-3d;
    box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.3);
  }

  .pricing-card-highlighted {
    box-shadow: 
      0 20px 60px -10px rgba(102, 212, 255, 0.3),
      0 0 0 1px rgba(102, 212, 255, 0.3);
    transform: scale(1.05);
  }

  @media (min-width: 768px) {
    .pricing-card-highlighted {
      transform: scale(1.08);
    }
  }

  .pricing-card:hover {
    box-shadow: 
      0 30px 60px -15px rgba(0, 0, 0, 0.4),
      0 0 0 1px rgba(255, 255, 255, 0.2);
    transform: translateY(-8px) scale(1.02);
  }

  .pricing-card-highlighted:hover {
    box-shadow: 
      0 30px 60px -15px rgba(102, 212, 255, 0.4),
      0 0 0 1px rgba(102, 212, 255, 0.4);
    transform: translateY(-8px) scale(1.1);
  }

  /* Badge animation */
  .pricing-badge {
    animation: badge-float 3s ease-in-out infinite;
  }

  @keyframes badge-float {
    0%, 100% { transform: translate(-50%, 0); }
    50% { transform: translate(-50%, -5px); }
  }

  /* Price animations */
  .pricing-price-number {
    transition: all 0.4s ease;
  }

  .pricing-card:hover .pricing-price-number {
    text-shadow: 0 0 20px rgba(102, 212, 255, 0.4);
  }

  /* Feature items entrance */
  .pricing-feature-item {
    opacity: 0;
    animation: feature-fade-in 0.5s ease forwards;
  }

  @keyframes feature-fade-in {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* CTA button effects */
  .pricing-cta-button {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .pricing-card:hover .pricing-cta-button {
    transform: translateY(-2px);
  }
</style>
