---
import SectionTitle from '../shared/SectionTitle.astro';
import MethodStep from './MethodStep.astro';
import { methodSteps } from '../../data/methodSteps';
---

<section class="section-padding relative overflow-hidden">
  <!-- Enhanced Enterprise Dark Background -->
  <div class="absolute inset-0 z-0">
    <!-- Base dark gradient with richer colors -->
    <div class="absolute inset-0 bg-gradient-to-br from-[#0a1929] via-[#0D2A47] to-[#1a3a52]"></div>
    
    <!-- Multiple layered overlays for depth -->
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-celeste-tech/10 via-transparent to-transparent"></div>
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,_var(--tw-gradient-stops))] from-azul-electrico/10 via-transparent to-transparent"></div>
    <div class="absolute inset-0 bg-gradient-to-t from-[#0a1929]/90 via-transparent to-[#0a1929]/60"></div>
  </div>
  
  <!-- Enhanced tech pattern overlay with animation -->
  <div class="absolute inset-0 opacity-[0.04] z-[1] tech-grid">
    <div class="absolute inset-0" style="background-image: 
      radial-gradient(circle at 2px 2px, rgba(255,255,255,0.15) 1px, transparent 0),
      linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.02) 50%, transparent 100%);
      background-size: 50px 50px, 100% 100%;">
    </div>
  </div>
  
  <!-- Enhanced floating gradient orbs with better positioning -->
  <div class="absolute -top-10 right-0 w-[500px] h-[500px] bg-gradient-radial from-celeste-tech/15 to-transparent rounded-full blur-3xl animate-float-slow z-[1]"></div>
  <div class="absolute bottom-20 -left-20 w-[450px] h-[450px] bg-gradient-radial from-azul-electrico/12 to-transparent rounded-full blur-3xl animate-float-slower z-[1]"></div>
  <div class="absolute top-1/2 left-1/3 w-[350px] h-[350px] bg-gradient-radial from-[#b4cfa6]/8 to-transparent rounded-full blur-3xl animate-float z-[1]"></div>
  <div class="absolute top-1/4 right-1/4 w-[300px] h-[300px] bg-gradient-radial from-white/5 to-transparent rounded-full blur-3xl animate-pulse-slow z-[1]"></div>
  
  <!-- Enhanced accent lines with glow -->
  <div class="absolute top-0 right-0 w-2/5 h-px bg-gradient-to-r from-transparent via-celeste-tech/40 to-transparent z-[1] shadow-[0_0_20px_rgba(100,200,255,0.3)]"></div>
  <div class="absolute top-20 left-0 w-1/3 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent z-[1]"></div>
  <div class="absolute bottom-0 left-0 w-1/2 h-px bg-gradient-to-r from-transparent via-azul-electrico/40 to-transparent z-[1] shadow-[0_0_20px_rgba(100,150,255,0.3)]"></div>
  
  <!-- Enhanced vertical timeline with glow effect -->
  <div class="absolute left-8 md:left-16 top-1/2 transform -translate-y-1/2 hidden md:block z-[1]">
    <div class="w-1 h-3/4 bg-gradient-to-b from-transparent via-celeste-tech/30 to-transparent relative rounded-full overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-b from-celeste-tech/40 via-white/30 to-celeste-tech/40 blur-md"></div>
      <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/20 to-transparent animate-shimmer"></div>
    </div>
  </div>

  <!-- Subtle corner decorations -->
  <div class="absolute top-0 left-0 w-32 h-32 border-t-2 border-l-2 border-celeste-tech/20 rounded-tl-3xl z-[1]"></div>
  <div class="absolute bottom-0 right-0 w-32 h-32 border-b-2 border-r-2 border-celeste-tech/20 rounded-br-3xl z-[1]"></div>

  <div class="container-custom relative z-10">
    <!-- Enhanced header with better spacing and effects -->
    <div class="text-center mb-20">
      <div class="inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-white/15 to-white/10 backdrop-blur-xl rounded-full mb-8 border border-white/30 shadow-lg shadow-celeste-tech/10 hover:shadow-celeste-tech/20 transition-all duration-300 group">
        <div class="w-2 h-2 rounded-full bg-celeste-tech animate-pulse"></div>
        <span class="text-white font-bold text-sm uppercase tracking-wider">
          C√≥mo trabajamos
        </span>
        <div class="w-2 h-2 rounded-full bg-celeste-tech animate-pulse animation-delay-150"></div>
      </div>
      
      <h2 class="font-heading font-bold text-4xl md:text-5xl lg:text-6xl text-white mb-8 leading-tight px-4" style="text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 40px rgba(100, 200, 255, 0.1);">
        M√©todo probado en<br class="md:hidden" />
        <span class="inline-block mt-2 text-transparent bg-clip-text bg-gradient-to-r from-celeste-tech via-[#a8d5ff] to-[#b4cfa6] animate-gradient-shift relative">
          5 pasos claros
          <div class="absolute -inset-1 bg-gradient-to-r from-celeste-tech/20 to-[#b4cfa6]/20 blur-xl -z-10"></div>
        </span>
      </h2>
      
      <p class="text-white/90 text-lg md:text-xl lg:text-2xl max-w-3xl mx-auto leading-relaxed px-4" style="text-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);">
        Un proceso estructurado y predecible: sab√©s exactamente qu√© esperar en cada etapa
      </p>

      <!-- Decorative line under header -->
      <div class="mt-10 flex items-center justify-center gap-4">
        <div class="h-px w-24 bg-gradient-to-r from-transparent to-celeste-tech/50"></div>
        <div class="w-3 h-3 rounded-full bg-celeste-tech/50 animate-pulse"></div>
        <div class="h-px w-24 bg-gradient-to-l from-transparent to-celeste-tech/50"></div>
      </div>
    </div>

    <!-- Method steps with enhanced spacing -->
    <div class="mt-20 space-y-12 md:space-y-16 relative">
      {methodSteps.map((step, index) => (
        <MethodStep step={step} index={index} />
      ))}
    </div>

    <!-- Premium CTA Final -->
    <div class="mt-24 text-center relative">
      <!-- Enhanced glow effects -->
      <div class="absolute -inset-8 bg-gradient-radial from-celeste-tech/10 via-celeste-tech/5 to-transparent rounded-full blur-3xl"></div>
      <div class="absolute inset-0 bg-celeste-tech/5 rounded-3xl blur-2xl animate-pulse-slow"></div>
      
      <div class="relative bg-gradient-to-br from-white/15 via-white/10 to-white/5 backdrop-blur-2xl border border-white/30 rounded-3xl p-10 md:p-16 text-white overflow-hidden group hover:border-celeste-tech/50 transition-all duration-500 shadow-2xl hover:shadow-celeste-tech/20">
        
        <!-- Animated background gradient -->
        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700">
          <div class="absolute inset-0 bg-gradient-to-br from-celeste-tech/10 via-transparent to-azul-electrico/10"></div>
        </div>

        <!-- Enhanced corner decorations -->
        <div class="absolute top-0 left-0 w-24 h-24 border-t-2 border-l-2 border-celeste-tech/30 rounded-tl-2xl opacity-50 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500"></div>
        <div class="absolute bottom-0 right-0 w-24 h-24 border-b-2 border-r-2 border-celeste-tech/30 rounded-br-2xl opacity-50 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500"></div>
        
        <!-- Floating particles effect -->
        <div class="absolute top-4 right-8 w-2 h-2 bg-celeste-tech/40 rounded-full animate-float"></div>
        <div class="absolute bottom-8 left-12 w-2 h-2 bg-celeste-tech/40 rounded-full animate-float-slow"></div>
        <div class="absolute top-1/2 right-16 w-1.5 h-1.5 bg-white/30 rounded-full animate-float-slower"></div>
        
        <div class="relative z-10">
          <div class="inline-block mb-6">
            <span class="text-5xl md:text-6xl animate-bounce-slow inline-block">üöÄ</span>
          </div>
          
          <h3 class="font-heading font-bold text-3xl md:text-4xl mb-6 leading-tight" style="text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);">
            ¬øListo para transformar tu cl√≠nica?
          </h3>
          
          <p class="text-white/80 text-lg md:text-xl mb-8 max-w-2xl mx-auto leading-relaxed">
            Agenda una llamada de diagn√≥stico <strong class="text-celeste-tech">(30 min, sin costo)</strong> y descubr√≠ c√≥mo aplicar este m√©todo a tu realidad espec√≠fica
          </p>
          
          <a 
            href="/contacto"
            class="inline-flex items-center gap-3 bg-gradient-to-r from-celeste-tech to-azul-electrico hover:from-celeste-tech/90 hover:to-azul-electrico/90 text-white px-10 py-5 rounded-2xl font-bold text-lg hover:scale-105 transition-all duration-300 shadow-[0_10px_40px_rgba(100,200,255,0.3)] hover:shadow-[0_20px_60px_rgba(100,200,255,0.5)] group/button"
          >
            <span class="text-2xl group-hover/button:scale-110 transition-transform duration-300"></span>
            <span>Agendar diagn√≥stico gratuito</span>
            <svg class="w-6 h-6 group-hover/button:translate-x-2 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
          </a>

          <!-- Trust badges bajo el CTA -->
          <div class="mt-8 flex flex-wrap items-center justify-center gap-6 text-sm text-white/60">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span>Sin compromiso</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span>30 minutos</span>
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span>100% gratis</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Enhanced Intersection Observer with stagger effect
  document.addEventListener('DOMContentLoaded', () => {
    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -80px 0px',
      threshold: 0.15
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          // Stagger animation delay
          setTimeout(() => {
            entry.target.classList.add('animate-in');
          }, index * 100);
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    const methodCards = document.querySelectorAll('.method-step-card');
    methodCards.forEach(card => observer.observe(card));
  });
</script>

<style>
  /* Enhanced floating animations */
  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(15px, -15px) scale(1.03); }
    66% { transform: translate(-10px, 10px) scale(1.05); }
  }
  
  @keyframes float-slow {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(-20px, 20px) scale(1.04); }
    66% { transform: translate(15px, -10px) scale(1.06); }
  }
  
  @keyframes float-slower {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(25px, -25px) scale(1.08); }
  }

  @keyframes pulse-slow {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }

  @keyframes bounce-slow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  @keyframes shimmer {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
  }

  @keyframes gradient-shift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .animate-float {
    animation: float 18s ease-in-out infinite;
  }
  
  .animate-float-slow {
    animation: float-slow 22s ease-in-out infinite;
  }
  
  .animate-float-slower {
    animation: float-slower 28s ease-in-out infinite;
  }

  .animate-pulse-slow {
    animation: pulse-slow 4s ease-in-out infinite;
  }

  .animate-bounce-slow {
    animation: bounce-slow 2s ease-in-out infinite;
  }

  .animate-shimmer {
    animation: shimmer 3s ease-in-out infinite;
  }

  .animate-gradient-shift {
    background-size: 200% auto;
    animation: gradient-shift 8s ease infinite;
  }

  .animation-delay-150 {
    animation-delay: 150ms;
  }

  .bg-gradient-radial {
    background-image: radial-gradient(circle, var(--tw-gradient-stops));
  }

  .tech-grid {
    animation: tech-grid-pulse 4s ease-in-out infinite;
  }

  @keyframes tech-grid-pulse {
    0%, 100% { opacity: 0.04; }
    50% { opacity: 0.06; }
  }

  /* Enhanced header animations */
  .container-custom > div:first-child {
    animation: fadeInDown 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enhanced CTA animation */
  .container-custom > div:last-child {
    animation: fadeInUp 1s cubic-bezier(0.16, 1, 0.3, 1) forwards 0.6s;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Performance optimizations */
  @media (prefers-reduced-motion: no-preference) {
    .animate-float,
    .animate-float-slow,
    .animate-float-slower,
    .animate-pulse-slow,
    .animate-bounce-slow,
    .animate-shimmer {
      will-change: transform, opacity;
    }
  }

  /* Accessibility: reduce motion */
  @media (prefers-reduced-motion: reduce) {
    .method-step-card,
    .container-custom > div,
    .animate-float,
    .animate-float-slow,
    .animate-float-slower,
    .animate-pulse-slow,
    .animate-bounce-slow,
    .animate-shimmer,
    .animate-gradient-shift {
      animation: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
</style>